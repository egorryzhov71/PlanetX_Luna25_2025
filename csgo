import telebot
import requests

bot = telebot.TeleBot('8186254854:AAHuaB_T2LbRlCXoDvihBVC_PM_j109JcoM')
API = '823828c9-dddb-4dfb-996a-ec22a8fd69b5'


@bot.message_handler(commands=['start'])
def start(message):
    bot.send_message(message.chat.id, '–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –Ω–∏–∫–Ω–µ–π–º Faceit')


@bot.message_handler(content_types=['text'])
def get_stats(message):
    nickname = message.text.strip()

    try:

        headers = {"Authorization": f"Bearer {API}"}
        player_response = requests.get(
            f"https://open.faceit.com/data/v4/players?nickname={nickname}",headers=headers)
        

        if player_response.status_code != 200:
            bot.send_message(message.chat.id, "üîç –ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∏–∫.")
            return

        player_id = player_response.json()["player_id"]

        # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        stats_response = requests.get(
            f"https://open.faceit.com/data/v4/players/{player_id}/games/cs2/stats",
            headers=headers
        )

        if stats_response.status_code != 200:
            bot.send_message(message.chat.id, "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É")
            return

        stats = stats_response.json()

        # –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
        response_text = (
            f"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ {nickname} –Ω–∞ Faceit (CS2):\n"
            f"üî´ K/D Ratio: {stats['lifetime']['Average K/D Ratio']}\n"
            f"üéØ –°—Ä–µ–¥–Ω–∏–µ —É–±–∏–π—Å—Ç–≤–∞: {stats['lifetime']['Average Kills']}\n"
            f"üèÜ –í—Å–µ–≥–æ –º–∞—Ç—á–µ–π: {stats['lifetime']['Matches']}\n"
            f"üìà Win Rate: {stats['lifetime']['Win Rate %']}%"
        )

        bot.send_message(message.chat.id, response_text)

    except KeyError:
        bot.send_message(message.chat.id, "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞")
    except Exception as e:
        bot.send_message(message.chat.id, f"‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {str(e)}")


bot.polling(none_stop=True)
